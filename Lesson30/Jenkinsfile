pipeline {
    agent any
    
    parameters {
        choice(
            name: 'ENVIRONMENT',
            choices: ['dev', 'test', 'prod'],
            description: '–¶–µ–ª–µ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è –¥–µ–ø–ª–æ—è'
        )
        string(
            name: 'IMAGE_TAG',
            defaultValue: 'v1.0',
            description: '–¢–µ–≥ Docker-–æ–±—Ä–∞–∑–∞'
        )
        booleanParam(
            name: 'RUN_TESTS',
            defaultValue: true,
            description: '–ó–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã?'
        )
        booleanParam(
            name: 'GENERATE_REPORT',
            defaultValue: true,
            description: '–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç?'
        )
        choice(
            name: 'REPORT_FORMAT',
            choices: ['html', 'json', 'txt'],
            description: '–§–æ—Ä–º–∞—Ç –æ—Ç—á—ë—Ç–∞'
        )
    }
    
    environment {
        APP_NAME = 'tms-app'
        BUILD_ID = "${BUILD_NUMBER}"
        PROJECT_DIR = 'Lesson30'
    }
    
    options {
        timeout(time: 30, unit: 'MINUTES')
        buildDiscarder(logRotator(numToKeepStr: '10'))
        disableConcurrentBuilds()
        preserveStashes(buildCount: 5)
    }
    
    stages {
        stage('Initialize') {
            steps {
                echo "üöÄ –ó–∞–ø—É—Å–∫ Pipeline #${BUILD_NUMBER} –¥–ª—è –∑–∞–¥–∞–Ω–∏—è 30"
                echo "üìÅ –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: ${env.WORKSPACE}"
                echo "üìÅ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞: ${env.PROJECT_DIR}"
                
                sh """
                    echo "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:"
                    find . -maxdepth 2 -type f \\( -name "*.groovy" -o -name "*.py" -o -name "Jenkinsfile" \\) | sort
                    echo ""
                    echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ \${PROJECT_DIR}:"
                    ls -la \${PROJECT_DIR} 2>/dev/null || echo "–ü–∞–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
                """
            }
        }
        
        stage('Checkout') {
            steps {
                echo "üì¶ –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è..."
                git branch: 'master', 
                    url: 'https://github.com/Kaverxp/TMS-Git.git',
                    poll: false
                
                dir(env.PROJECT_DIR) {
                    sh '''
                        echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ Lesson30:"
                        ls -la
                        echo ""
                        echo "–§–∞–π–ª—ã –∑–∞–¥–∞–Ω–∏—è:"
                        find . -type f \\( -name "*.groovy" -o -name "*.py" \\) | sort
                    '''
                }
            }
        }
        
        stage('Build') {
            when {
                expression { params.ENVIRONMENT != 'prod' }
            }
            steps {
                echo "üî® –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
                
                dir(env.PROJECT_DIR) {
                    script {
                        try {
                            if (fileExists('deploy.groovy')) {
                                echo "‚úÖ –ù–∞–π–¥–µ–Ω deploy.groovy"
                            } else {
                                error "‚ùå –§–∞–π–ª deploy.groovy –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ ${env.PROJECT_DIR}"
                            }
                            
                            if (fileExists('report_dsl.py')) {
                                echo "‚úÖ –ù–∞–π–¥–µ–Ω report_dsl.py"
                            } else {
                                echo "‚ö† –§–∞–π–ª report_dsl.py –Ω–µ –Ω–∞–π–¥–µ–Ω"
                            }
                            
                        } catch (Exception e) {
                            echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–π–ª–æ–≤: ${e.message}"
                            error e.message
                        }
                    }
                }
            }
        }
        
        stage('Test') {
            when {
                allOf {
                    expression { params.RUN_TESTS == true }
                    expression { params.ENVIRONMENT != 'prod' }
                }
            }
            steps {
                echo "üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤..."
                
                dir(env.PROJECT_DIR) {
                    script {
                        try {
                            echo "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Groovy —Å–∫—Ä–∏–ø—Ç–∞..."
                            sh '''
                                echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ Groovy:"
                                if command -v groovy >/dev/null 2>&1; then
                                    groovy -c deploy.groovy 2>/dev/null && echo "‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å Groovy –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω" || echo "‚ö† –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å Groovy"
                                else
                                    echo "‚ö† Groovy –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–ø—É—â–µ–Ω–∞"
                                fi
                                
                                echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞ –¥–µ–ø–ª–æ—è:"
                                head -20 deploy.groovy | grep -q "def call" && echo "‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∫—Ä–∏–ø—Ç–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞" || echo "‚ö† –ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞"
                            '''
                            
                            echo "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Python DSL..."
                            sh '''
                                echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ Python —Å–∫—Ä–∏–ø—Ç–∞:"
                                if python3 -m py_compile report_dsl.py 2>/dev/null; then
                                    echo "‚úÖ Python —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω"
                                else
                                    echo "‚ö† –û—à–∏–±–∫–∞ Python —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞"
                                fi
                                
                                echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ DSL –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:"
                                python3 report_dsl.py --help 2>&1 | head -5 || true
                            '''
                            
                        } catch (Exception e) {
                            echo "‚ö† –¢–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å —Å –æ—à–∏–±–∫–æ–π: ${e.message}"
                            currentBuild.result = 'UNSTABLE'
                        }
                    }
                }
            }
            
            post {
                always {
                    echo "üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã"
                    junit(
                        testResults: '**/test-reports/*.xml', 
                        allowEmptyResults: true,
                        skipPublishingChecks: true
                    )
                }
            }
        }
        
        stage('Generate Report') {
            when {
                allOf {
                    expression { params.GENERATE_REPORT == true }
                    expression { fileExists("${env.PROJECT_DIR}/report_dsl.py") }
                }
            }
            steps {
                echo "üìä –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º DSL..."
                
                dir(env.PROJECT_DIR) {
                    script {
                        try {
                            sh '''
                                python3 --version || python --version || echo "Python –Ω–µ –Ω–∞–π–¥–µ–Ω"
                            '''
                            
                            sh 'mkdir -p generated_reports'
                            
                            sh """
                                echo "–ó–∞–ø—É—Å–∫ DSL –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –æ—Ç—á—ë—Ç–æ–≤..."
                                python3 report_dsl.py \\
                                    --type jenkins_pipeline \\
                                    --period \$(date +%Y-%m) \\
                                    --format ${params.REPORT_FORMAT} \\
                                    --output-dir ./generated_reports \\
                                    --filter environment=${params.ENVIRONMENT} \\
                                    --filter pipeline=lesson30 \\
                                    --filter build_number=${BUILD_NUMBER} \\
                                    --filter image_tag=${params.IMAGE_TAG}
                            """
                            
                        } catch (Exception e) {
                            echo "‚ö† –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–∞: ${e.message}"
                            
                            sh """
                                echo "–°–æ–∑–¥–∞—é –ø—Ä–æ—Å—Ç–æ–π –æ—Ç—á—ë—Ç..."
                                mkdir -p generated_reports
                                cat > generated_reports/error_report.txt << EOF
–û—Ç—á—ë—Ç –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏—è 30
============================
–í—Ä–µ–º—è: \$(date)
–ù–æ–º–µ—Ä —Å–±–æ—Ä–∫–∏: ${BUILD_NUMBER}
–û–∫—Ä—É–∂–µ–Ω–∏–µ: ${params.ENVIRONMENT}
–°—Ç–∞—Ç—É—Å: ERROR
–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–∞: ${e.message}
EOF
                            """
                            currentBuild.result = 'UNSTABLE'
                        }
                    }
                }
            }
            
            post {
                always {
                    dir(env.PROJECT_DIR) {
                        archiveArtifacts artifacts: 'generated_reports/**', fingerprint: true
                    }
                }
                success {
                    echo "‚úÖ –û—Ç—á—ë—Ç —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω"
                    
                    dir(env.PROJECT_DIR) {
                        sh 'ls -la generated_reports/'
                    }
                    
                    script {
                        if (params.REPORT_FORMAT == 'html') {
                            publishHTML(
                                target: [
                                    allowMissing: false,
                                    alwaysLinkToLastBuild: true,
                                    keepAll: true,
                                    reportDir: "${env.PROJECT_DIR}/generated_reports",
                                    reportFiles: '*.html',
                                    reportName: 'Lesson 30 Report'
                                ]
                            )
                        }
                    }
                }
            }
        }
        
        stage('Execute Groovy Deployment') {
            when {
                expression { params.ENVIRONMENT in ['dev', 'test', 'prod'] }
            }
            steps {
                echo "üöÄ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ Groovy —Å–∫—Ä–∏–ø—Ç–∞ –¥–µ–ø–ª–æ—è..."
                
                dir(env.PROJECT_DIR) {
                    script {
                        try {
                            def deployScript = load 'deploy.groovy'
                            
                            deployScript.call([
                                imageName: env.APP_NAME,
                                imageTag: params.IMAGE_TAG,
                                containerName: "${env.APP_NAME}-${params.ENVIRONMENT}-lesson30",
                                port: 9090,
                                environment: params.ENVIRONMENT,
                                buildNumber: BUILD_NUMBER,
                                projectDir: env.PROJECT_DIR
                            ])
                            
                        } catch (Exception e) {
                            echo "‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –¥–µ–ø–ª–æ—è: ${e.message}"
                            error "–î–µ–ø–ª–æ–π –ø—Ä–µ—Ä–≤–∞–Ω: ${e.message}"
                        }
                    }
                }
            }
            
            post {
                success {
                    echo "‚úÖ –î–µ–ø–ª–æ–π –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ"
                }
                failure {
                    echo "‚ùå –û—à–∏–±–∫–∞ –¥–µ–ø–ª–æ—è"
                    sh '''
                        echo "–ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–∫–∞—Ç–∞..."
                        docker ps -a --filter "name=tms-app.*lesson30" -q | xargs -r docker stop 2>/dev/null || true
                        docker ps -a --filter "name=tms-app.*lesson30" -q | xargs -r docker rm 2>/dev/null || true
                    '''
                }
            }
        }
        
        stage('Verify Deployment') {
            when {
                expression { params.ENVIRONMENT in ['dev', 'test'] }
            }
            steps {
                echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è..."
                
                script {
                    retry(3) {
                        sleep 3
                        
                        sh """
                            echo "=== –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∑–∞–¥–∞–Ω–∏—è 30 ==="
                            echo "–ê–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:"
                            docker ps --filter "name=lesson30" --format "table {{.Names}}\\t{{.Status}}\\t{{.Ports}}" || true
                            
                            echo ""
                            echo "–í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å –º–µ—Ç–∫–æ–π lesson30:"
                            docker ps -a --filter "name=lesson30" --format "table {{.Names}}\\t{{.Status}}" || true
                            
                            echo ""
                            echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞:"
                            du -sh \${WORKSPACE}/\${PROJECT_DIR} 2>/dev/null || echo "–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä"
                        """
                    }
                }
            }
        }
        
        stage('Archive Artifacts') {
            steps {
                echo "üì¶ –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤..."
                
                script {
                    // –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ Lesson30
                    dir(env.PROJECT_DIR) {
                        archiveArtifacts artifacts: '**', fingerprint: true
                        echo "‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ –∑–∞–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω—ã"
                        
                        // –û—Ç–¥–µ–ª—å–Ω–æ –∞—Ä—Ö–∏–≤–∏—Ä—É–µ–º –∫–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã
                        archiveArtifacts artifacts: '*.groovy,*.py,*.md,Jenkinsfile', fingerprint: true
                        echo "‚úÖ –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã –∑–∞–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω—ã"
                    }
                }
            }
        }
        
        stage('Cleanup') {
            steps {
                echo "üßπ –û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è..."
                
                script {
                    // –°–æ–∑–¥–∞–µ–º –ª–æ–≥–∏ –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞
                    sh """
                        echo "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤..."
                        mkdir -p \${WORKSPACE}/logs
                        docker logs tms-app-${params.ENVIRONMENT}-lesson30 2>/dev/null | tail -100 > \${WORKSPACE}/logs/docker.log || echo "–õ–æ–≥–∏ Docker –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã"
                        date > \${WORKSPACE}/logs/completion_time.txt
                        echo "–°–æ–∑–¥–∞–Ω–Ω—ã–µ –ª–æ–≥–∏:"
                        ls -la \${WORKSPACE}/logs/
                    """
                    
                    // –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º –ª–æ–≥–∏ –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
                    archiveArtifacts artifacts: 'logs/**', fingerprint: true
                    echo "‚úÖ –õ–æ–≥–∏ –∑–∞–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω—ã"
                    
                    // –£–¥–∞–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ç–æ–ª—å–∫–æ –≤ dev/test –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö
                    if (params.ENVIRONMENT in ['dev', 'test']) {
                        sh '''
                            echo "–û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∑–∞–¥–∞–Ω–∏—è 30..."
                            docker ps -a --filter "name=.*lesson30" -q | xargs -r docker stop 2>/dev/null || true
                            docker ps -a --filter "name=.*lesson30" -q | xargs -r docker rm 2>/dev/null || true
                            
                            echo "–û—á–∏—Å—Ç–∫–∞ –æ–±—Ä–∞–∑–æ–≤ –∑–∞–¥–∞–Ω–∏—è 30..."
                            docker images --filter "reference=*lesson30*" -q | xargs -r docker rmi 2>/dev/null || true
                        '''
                    } else {
                        echo "‚ö† –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"
                    }
                }
            }
        }
    }
    
    post {
        success {
            echo """
            üéâ –ó–ê–î–ê–ù–ò–ï 30 –í–´–ü–û–õ–ù–ï–ù–û –£–°–ü–ï–®–ù–û!
            ===============================
            –ü—Ä–æ–µ–∫—Ç: ${env.APP_NAME}
            –ó–∞–¥–∞–Ω–∏–µ: –£—Ä–æ–∫ 30 - Jenkins Pipeline
            –û–∫—Ä—É–∂–µ–Ω–∏–µ: ${params.ENVIRONMENT}
            –°–±–æ—Ä–∫–∞: #${BUILD_NUMBER}
            –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${currentBuild.durationString}
            
            –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
            ‚úÖ Pipeline —Å–æ–∑–¥–∞–Ω (–¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å)
            ‚úÖ Groovy —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è –≤—ã–ø–æ–ª–Ω–µ–Ω
            ‚úÖ DSL –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω
            ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
            
            –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–±–æ—Ä–∫—É: ${env.BUILD_URL}
            """
        }
        
        failure {
            echo """
            ‚ùå –í–´–ü–û–õ–ù–ï–ù–ò–ï –ó–ê–î–ê–ù–ò–Ø 30 –ü–†–ï–†–í–ê–ù–û!
            ==================================
            –ü—Ä–∏—á–∏–Ω–∞: ${currentBuild.result}
            
            –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
            1. –ù–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–µ ${env.PROJECT_DIR}/
            2. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Docker
            3. –õ–æ–≥–∏ —Å–±–æ—Ä–∫–∏: ${env.BUILD_URL}console
            
            –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Ä—É—á–Ω—É—é:
            cd ${env.WORKSPACE}/${env.PROJECT_DIR}
            ls -la
            """
        }
        
        unstable {
            echo """
            ‚ö† –ó–ê–î–ê–ù–ò–ï 30 –í–´–ü–û–õ–ù–ï–ù–û –° –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–Ø–ú–ò
            =========================================
            –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
            - –¢–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å —Å –æ—à–∏–±–∫–∞–º–∏
            - –ü—Ä–æ–±–ª–µ–º—ã —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –æ—Ç—á—ë—Ç–æ–≤
            - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö
            
            –î–µ—Ç–∞–ª–∏: ${env.BUILD_URL}testReport
            """
        }
        
        always {
            echo """
            üìã –ò–¢–û–ì–ò –í–´–ü–û–õ–ù–ï–ù–ò–Ø –ó–ê–î–ê–ù–ò–Ø 30
            ==============================
            –í—Ä–µ–º—è: ${new Date().toString()}
            –°—Ç–∞—Ç—É—Å: ${currentBuild.result}
            –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${currentBuild.durationString}
            –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: ${env.WORKSPACE}
            
            –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã:
            - Jenkins Pipeline
            - Groovy —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è
            - DSL –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–æ–≤
            - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
            
            –ü–∞–ø–∫–∞ —Å —Ñ–∞–π–ª–∞–º–∏ –∑–∞–¥–∞–Ω–∏—è: ${env.PROJECT_DIR}/
            """
            
            // –§–∏–Ω–∞–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤ —Å–∞–º–æ–º –∫–æ–Ω—Ü–µ
            cleanWs(
                cleanWhenAborted: true,
                cleanWhenFailure: true,
                cleanWhenNotBuilt: true,
                cleanWhenSuccess: true,
                cleanWhenUnstable: true,
                deleteDirs: true
            )
        }
    }
}